---
import BaseLayout from '../layouts/BaseLayout.astro';
---

<BaseLayout title="Usage">
  <h1>Usage</h1>
  <p class="subtitle">Build algorithm visualization videos from JSON scene specs.</p>

  <h2>Prerequisites</h2>
  <ul>
    <li><strong>Python 3.10+</strong> with pip</li>
    <li><strong>FFmpeg</strong> at <code>~/.local/bin/ffmpeg</code></li>
    <li><strong>OpenAI API key</strong> for TTS (or swap adapter for local TTS)</li>
  </ul>

  <h2>Build a Scene</h2>
  <div class="command-block">
    <code>python build.py scenes/two_pointers/scene.json -v</code>
  </div>
  <p>The <code>-v</code> flag shows pipeline progress. Output goes to <code>output/{scene_name}/final.mp4</code>.</p>

  <h2>Scene Spec Structure</h2>
  <p>Each scene is a JSON file with metadata and an array of steps:</p>
  <pre><code set:html={`{
  "title": "Two Sum II - Two Pointers",
  "template": "array_animation",
  "array": [2, 7, 11, 15],
  "target": 9,
  "steps": [
    {
      "narration": "We start with two pointers at each end.",
      "state": { "left": 0, "right": 3 }
    },
    {
      "narration": "Two plus fifteen equals seventeen. Too big.",
      "state": { "left": 0, "right": 2, "highlight": [0, 3] }
    }
  ]
}`} /></pre>

  <h2>State Properties</h2>
  <p>The <code>state</code> object controls what the template renders. Properties depend on the template:</p>

  <h3>array_animation template</h3>
  <ul>
    <li><code>left</code>, <code>right</code> — Pointer indices (names are flexible: <code>i</code>, <code>j</code>, <code>slow</code>, <code>fast</code>)</li>
    <li><code>highlight</code> — Array of indices to highlight</li>
    <li><code>message</code> — Text to display below the visualization</li>
  </ul>

  <h3>hash_table template</h3>
  <ul>
    <li><code>current_index</code> — Index being processed</li>
    <li><code>hashmap_entries</code> — Array of <code>{`{value, index}`}</code> objects</li>
    <li><code>lookup_value</code> — Value being looked up in the map</li>
    <li><code>found_pair</code> — Indices of the solution pair</li>
  </ul>

  <h2>Narration Guidelines</h2>
  <ul>
    <li><strong>One phrase per step</strong> — Keep each narration short and focused</li>
    <li><strong>Be specific</strong> — "Move right pointer left" not "adjust pointer"</li>
    <li><strong>Match the visual</strong> — Describe what's changing on screen</li>
    <li><strong>Comfortable pace</strong> — Viewers need time to process</li>
  </ul>

  <h2>Composing Scenes</h2>
  <p>Multiple scenes can be stitched into a full tutorial using <code>index.json</code>:</p>
  <pre><code set:html={`{
  "title": "Two Sum Complete Tutorial",
  "scenes": [
    "problem/scene.json",
    "brute/scene.json",
    "hashtable/scene.json"
  ]
}`} /></pre>
  <div class="command-block">
    <code>python build.py scenes/two_sum/index.json -v</code>
  </div>

  <h2>Output Files</h2>
  <p>Each build creates:</p>
  <ul>
    <li><code>animation.html</code> — The rendered HTML animation</li>
    <li><code>step_*.wav</code> — Individual TTS audio files</li>
    <li><code>video.webm</code> — Recorded animation</li>
    <li><code>audio.m4a</code> — Concatenated audio track</li>
    <li><code>final.mp4</code> — The finished video</li>
  </ul>
</BaseLayout>
